<div id="chatroom-status"></div>
<div id="chatroom-container" style="overflow-y:scroll; height:200px">
    <ul class="list-group" id="user-list">
    </ul>
</div>
<div id="user-panel"></div>
<button class="btn btn-sm btn-warning" id="leave">Leave Chatroom</button>
{{!-- <button class="btn btn-sm btn-primary" id="invite">Invite Somebody</button> --}}
<script>
    $(function () {

        //Click the 'Leave chatroom' button to logout
        $("#leave").click((e) => {
            let isLeaveChatroom = confirm('Are you sure to leave this chatroom?');
            if (isLeaveChatroom == true) {
                
                window.location.href = '/lobby';
            }
        });

        //Leave the chatroom when window is close but still logged in
        $(window).on('unload', function(){
            socket.emit('user_leave_chatroom');
        });

        //Emit 'load_messages_from_redis' event intially
        socket.emit('load_users_in_chatroom_from_redis');

        //Display userlist in chatroom
        socket.on('show_users_in_chatroom', (data) => {
            let userlist_content = '';
            data.forEach((user) => {
                userlist_content += `<li class="list-group-item">${user.username}</li>`;
            });
            $('ul#user-list').html(userlist_content);
            $('#chatroom-status').html(`<h5 id="chatroom-status">${data.length} user(s) in this chatroom</h5>`);
        });

        //When another user enter the chatroom
        socket.on('add_user_in_chatroom', (data) => {
            console.log(data);
            let html = `<li class="list-group-item">${data.username}</li>`;
            $('ul#user-list').append(html);
        });

    });
</script>